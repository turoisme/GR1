<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/virtual-tryon.css">
</head>
<body>
    <%- include('../partials/header') %>

    <main class="virtual-tryon-page">
        <div class="container">
            <div class="page-header">
                <h1>üé≠ Th·ª≠ ƒë·ªì ·∫£o v·ªõi AI</h1>
                <p>Upload ·∫£nh c·ªßa b·∫°n v√† xem k·∫øt qu·∫£ th·ª≠ ƒë·ªì ngay l·∫≠p t·ª©c!</p>
            </div>

            <div class="tryon-container">
                <!-- Product Info -->
                <div class="product-section">
                    <div class="product-card">
                        <img src="<%= product.images[0] %>" alt="<%= product.name %>">
                        <div class="product-info">
                            <h3><%= product.name %></h3>
                            <p class="price"><%= product.price.toLocaleString('vi-VN') %>ƒë</p>
                            <p class="description"><%= product.description %></p>
                        </div>
                    </div>
                </div>

                <!-- Image Upload Section -->
                <div class="upload-section">
                    <h3>üì∏ Upload ·∫£nh c·ªßa b·∫°n</h3>
                    
                    <div class="image-upload-area" id="imageDropZone">
                        <input type="file" id="imageUpload" accept="image/*" style="display: none;">
                        
                        <div class="upload-placeholder" id="uploadPlaceholder">
                            <div class="upload-icon">üì∑</div>
                            <p>K√©o th·∫£ ·∫£nh v√†o ƒë√¢y ho·∫∑c click ƒë·ªÉ ch·ªçn</p>
                            <small>H·ªó tr·ª£: JPG, PNG, WEBP (t·ªëi ƒëa 10MB)</small>
                        </div>
                        
                        <img id="imagePreview" style="display: none;" alt="Preview">
                    </div>

                    <!-- Settings -->
                    <div class="tryon-settings">
                        <h4>‚öôÔ∏è C√†i ƒë·∫∑t n√¢ng cao</h4>
                        
                        <div class="setting-group">
                            <label for="strength">C∆∞·ªùng ƒë·ªô hi·ªáu ·ª©ng: <span id="strengthValue">0.8</span></label>
                            <input type="range" id="strength" min="0.1" max="1.0" step="0.1" value="0.8">
                        </div>
                        
                        <div class="setting-group">
                            <label for="guidance_scale">ƒê·ªô ch√≠nh x√°c: <span id="guidance_scaleValue">7.5</span></label>
                            <input type="range" id="guidance_scale" min="1" max="20" step="0.5" value="7.5">
                        </div>
                        
                        <div class="setting-group">
                            <label for="steps">S·ªë b∆∞·ªõc x·ª≠ l√Ω: <span id="stepsValue">20</span></label>
                            <input type="range" id="steps" min="10" max="50" step="5" value="20">
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="action-buttons">
                        <button id="startTryOn" class="btn btn-primary btn-large" disabled>
                            ‚ú® B·∫Øt ƒë·∫ßu th·ª≠ ƒë·ªì
                        </button>
                        
                        <button id="viewHistory" class="btn btn-secondary" onclick="window.location.href='/user/try-on-history'">
                            üì± L·ªãch s·ª≠ th·ª≠ ƒë·ªì
                        </button>
                    </div>
                </div>
            </div>

            <!-- Processing Status -->
            <div id="processingStatus" class="processing-status" style="display: none;">
                <!-- Content will be filled by JavaScript -->
            </div>

            <!-- Results -->
            <div id="tryOnResult" class="result-section" style="display: none;">
                <!-- Content will be filled by JavaScript -->
            </div>

            <!-- Batch Try-On Section -->
            <div class="batch-section">
                <h3>üõçÔ∏è Th·ª≠ nhi·ªÅu s·∫£n ph·∫©m c√πng l√∫c</h3>
                <p>Ch·ªçn c√°c s·∫£n ph·∫©m kh√°c ƒë·ªÉ th·ª≠ c√πng v·ªõi ·∫£nh ƒë√£ upload:</p>
                
                <div class="product-grid">
                    <% if (typeof relatedProducts !== 'undefined' && relatedProducts.length > 0) { %>
                        <% relatedProducts.forEach(product => { %>
                            <div class="product-item">
                                <input type="checkbox" class="product-checkbox" value="<%= product._id %>" id="product_<%= product._id %>">
                                <label for="product_<%= product._id %>">
                                    <img src="<%= product.images[0] %>" alt="<%= product.name %>">
                                    <div class="product-name"><%= product.name %></div>
                                    <div class="product-price"><%= product.price.toLocaleString('vi-VN') %>ƒë</div>
                                </label>
                            </div>
                        <% }) %>
                    <% } %>
                </div>
                
                <button id="batchTryOn" class="btn btn-outline">
                    üé® Th·ª≠ t·∫•t c·∫£ s·∫£n ph·∫©m ƒë√£ ch·ªçn
                </button>
            </div>

            <!-- Batch Results -->
            <div id="batchResults" class="batch-results" style="display: none;">
                <!-- Content will be filled by JavaScript -->
            </div>

            <!-- Tips Section -->
            <div class="tips-section">
                <h3>üí° M·∫πo ƒë·ªÉ c√≥ k·∫øt qu·∫£ t·ªët nh·∫•t</h3>
                <div class="tips-grid">
                    <div class="tip-item">
                        <div class="tip-icon">üßç</div>
                        <h4>T∆∞ th·∫ø ƒë·ª©ng th·∫≥ng</h4>
                        <p>ƒê·ª©ng th·∫≥ng, m·∫∑t h∆∞·ªõng v·ªÅ ph√≠a tr∆∞·ªõc ƒë·ªÉ AI c√≥ th·ªÉ x·ª≠ l√Ω t·ªët nh·∫•t</p>
                    </div>
                    
                    <div class="tip-item">
                        <div class="tip-icon">üí°</div>
                        <h4>√Ånh s√°ng t·ªët</h4>
                        <p>Ch·ª•p ·∫£nh trong ƒëi·ªÅu ki·ªán √°nh s√°ng t·ª± nhi√™n, tr√°nh b√≥ng m·ªù</p>
                    </div>
                    
                    <div class="tip-item">
                        <div class="tip-icon">üëï</div>
                        <h4>Trang ph·ª•c ƒë∆°n gi·∫£n</h4>
                        <p>M·∫∑c qu·∫ßn √°o ƒë∆°n gi·∫£n, tr√°nh h·ªça ti·∫øt ph·ª©c t·∫°p</p>
                    </div>
                    
                    <div class="tip-item">
                        <div class="tip-icon">üñºÔ∏è</div>
                        <h4>·∫¢nh ch·∫•t l∆∞·ª£ng cao</h4>
                        <p>S·ª≠ d·ª•ng ·∫£nh ƒë·ªô ph√¢n gi·∫£i cao, r√µ n√©t ƒë·ªÉ k·∫øt qu·∫£ t·ªët h∆°n</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <%- include('../partials/footer') %>

    <script src="/js/virtual-tryon.js"></script>
    <script>
        // Set current product ID
        document.addEventListener('DOMContentLoaded', () => {
            if (window.VirtualTryOn) {
                window.VirtualTryOn.currentProductId = '<%= product._id %>';
            }
        });
    </script>
</body>
</html>