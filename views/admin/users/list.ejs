<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title || 'Quản lý người dùng - SportShop Admin' %></title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8fafc;
            color: #333;
            line-height: 1.6;
        }

        /* Flash Messages */
        .flash-messages {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            max-width: 400px;
        }

        .flash-message {
            padding: 15px 20px;
            margin-bottom: 10px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            animation: slideIn 0.3s ease-out;
        }

        .flash-success {
            background: #28a745;
        }

        .flash-error {
            background: #dc3545;
        }

        .flash-warning {
            background: #ffc107;
            color: #212529;
        }

        .flash-info {
            background: #17a2b8;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 260px;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            overflow-y: auto;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .sidebar-header h2 {
            font-size: 1.4rem;
            font-weight: 600;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-item {
            margin-bottom: 5px;
        }

        .menu-item a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: all 0.3s ease;
            position: relative;
        }

        .menu-item a:hover {
            background: rgba(255,255,255,0.1);
            color: white;
            transform: translateX(5px);
        }

        .menu-item a.active {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .menu-item a.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: white;
        }

        .menu-item i {
            width: 20px;
            margin-right: 15px;
            text-align: center;
            font-size: 1.1rem;
        }

        /* Main Content */
        .main-content {
            margin-left: 260px;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: white;
            padding: 15px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left h1 {
            font-size: 1.8rem;
            color: #333;
            font-weight: 600;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        /* Content */
        .content {
            padding: 30px;
        }

        /* Stats Cards */
        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            margin: 0 auto 15px;
        }

        .stat-card.total .stat-icon {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .stat-card.active .stat-icon {
            background: linear-gradient(135deg, #28a745, #20c997);
        }

        .stat-card.new .stat-icon {
            background: linear-gradient(135deg, #17a2b8, #20c997);
        }

        .stat-card.admin .stat-icon {
            background: linear-gradient(135deg, #ffc107, #fd7e14);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-sm {
            padding: 8px 15px;
            font-size: 0.85rem;
        }

        /* Filters */
        .filters {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            margin-bottom: 25px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-group label {
            font-weight: 500;
            color: #333;
            white-space: nowrap;
        }

        .filter-group select,
        .filter-group input {
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            transition: border-color 0.3s ease;
            font-size: 0.9rem;
        }

        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        /* Users Table */
        .users-table {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .table-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-header h3 {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .table-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            padding: 8px 35px 8px 12px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            width: 250px;
            font-size: 0.9rem;
        }

        .search-box input::placeholder {
            color: rgba(255,255,255,0.7);
        }

        .search-box i {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255,255,255,0.7);
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #f1f5f9;
        }

        th {
            background: #f8fafc;
            font-weight: 600;
            color: #333;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .user-info-cell {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar-cell {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 1rem;
            flex-shrink: 0;
        }

        .user-details h4 {
            font-weight: 600;
            color: #333;
            margin-bottom: 3px;
            font-size: 0.95rem;
        }

        .user-details p {
            color: #666;
            font-size: 0.85rem;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            white-space: nowrap;
            margin-right: 5px;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .status-verified {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-unverified {
            background: #fff3cd;
            color: #856404;
        }

        .role-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            white-space: nowrap;
        }

        .role-admin {
            background: #fff3cd;
            color: #856404;
        }

        .role-user {
            background: #e2e3e5;
            color: #383d41;
        }

        .action-buttons-cell {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .pagination-btn {
            padding: 8px 15px;
            border: 2px solid #e0e0e0;
            background: white;
            color: #666;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            font-size: 0.9rem;
        }

        .pagination-btn:hover {
            border-color: #667eea;
            color: #667eea;
        }

        .pagination-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination-info {
            margin-left: 20px;
            color: #666;
            font-size: 0.9rem;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f5f9;
        }

        .modal-header h3 {
            font-size: 1.4rem;
            font-weight: 600;
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
            padding: 5px;
            border-radius: 5px;
            transition: background 0.3s ease;
        }

        .close-btn:hover {
            background: #f1f5f9;
        }

        /* Form */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 0.95rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #f1f5f9;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .main-content {
                margin-left: 0;
            }

            .header {
                padding: 15px 20px;
            }

            .content {
                padding: 20px;
            }

            .stats-cards {
                grid-template-columns: repeat(2, 1fr);
            }

            .filters {
                flex-direction: column;
                align-items: stretch;
            }

            .action-buttons {
                flex-direction: column;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .table-container {
                font-size: 0.85rem;
            }

            .search-box input {
                width: 180px;
            }

            .action-buttons-cell {
                flex-direction: column;
            }

            .pagination {
                flex-wrap: wrap;
                justify-content: center;
            }

            .pagination-info {
                margin-left: 0;
                margin-top: 10px;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            .stats-cards {
                grid-template-columns: 1fr;
            }
        }

        /* Loading */
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .btn.loading {
            opacity: 0.7;
            pointer-events: none;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .empty-state h3 {
            font-size: 1.3rem;
            margin-bottom: 10px;
        }

        .empty-state p {
            font-size: 0.95rem;
        }
    </style>
</head>
<body>
    <!-- Flash Messages -->
    <% if (typeof flashMessages !== 'undefined') { %>
        <div class="flash-messages">
            <% if (flashMessages.success && flashMessages.success.length > 0) { %>
                <% flashMessages.success.forEach(message => { %>
                    <div class="flash-message flash-success">
                        <i class="fas fa-check-circle"></i> <%= message %>
                    </div>
                <% }) %>
            <% } %>
            <% if (flashMessages.error && flashMessages.error.length > 0) { %>
                <% flashMessages.error.forEach(message => { %>
                    <div class="flash-message flash-error">
                        <i class="fas fa-exclamation-circle"></i> <%= message %>
                    </div>
                <% }) %>
            <% } %>
            <% if (flashMessages.warning && flashMessages.warning.length > 0) { %>
                <% flashMessages.warning.forEach(message => { %>
                    <div class="flash-message flash-warning">
                        <i class="fas fa-exclamation-triangle"></i> <%= message %>
                    </div>
                <% }) %>
            <% } %>
            <% if (flashMessages.info && flashMessages.info.length > 0) { %>
                <% flashMessages.info.forEach(message => { %>
                    <div class="flash-message flash-info">
                        <i class="fas fa-info-circle"></i> <%= message %>
                    </div>
                <% }) %>
            <% } %>
        </div>
    <% } %>

    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>SportShop Admin</h2>
        </div>
        
        <nav class="sidebar-menu">
            <div class="menu-item">
                <a href="/admin/">
                    <i class="fas fa-chart-pie"></i>
                    <span>Dashboard</span>
                </a>
            </div>
            <div class="menu-item">
                <a href="/admin/products">
                    <i class="fas fa-box"></i>
                    <span>Quản lý sản phẩm</span>
                </a>
            </div>
            <div class="menu-item">
                <a href="/admin/orders">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Quản lý đơn hàng</span>
                </a>
            </div>
            <div class="menu-item">
                <a href="/admin/users" class="<%= currentPage === 'admin-users' ? 'active' : '' %>">
                    <i class="fas fa-users"></i>
                    <span>Quản lý người dùng</span>
                </a>
            </div>
            <div class="menu-item">
                <a href="/admin/statistics">
                    <i class="fas fa-chart-bar"></i>
                    <span>Thống kê</span>
                </a>
            </div>
            <div class="menu-item">
                <a href="/admin/settings">
                    <i class="fas fa-cog"></i>
                    <span>Cài đặt</span>
                </a>
            </div>
            <div class="menu-item">
                <a href="/auth/logout">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Đăng xuất</span>
                </a>
            </div>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1>Quản lý người dùng</h1>
            </div>
            <div class="header-right">
                <div class="user-info">
                    <div class="user-avatar">
                        <%= (user && user.firstName) ? user.firstName.charAt(0).toUpperCase() : 'A' %>
                    </div>
                    <div>
                        <div style="font-weight: 500;">
                            <%= (user && user.firstName) ? `${user.firstName} ${user.lastName}` : 'Admin SportShop' %>
                        </div>
                        <div style="font-size: 0.8rem; color: #666;">
                            <%= (user && user.email) ? user.email : 'admin@sportshop.com' %>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Content -->
        <div class="content">
            <!-- Stats Cards -->
            <div class="stats-cards">
                <div class="stat-card total">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-value">
                        <%= (typeof users !== 'undefined' && users.length) ? users.length : 0 %>
                    </div>
                    <div class="stat-label">Tổng người dùng</div>
                </div>
                <div class="stat-card active">
                    <div class="stat-icon">
                        <i class="fas fa-user-check"></i>
                    </div>
                    <div class="stat-value">
                        <%= (typeof users !== 'undefined') ? users.filter(u => u.isActive).length : 0 %>
                    </div>
                    <div class="stat-label">Đang hoạt động</div>
                </div>
                <div class="stat-card new">
                    <div class="stat-icon">
                        <i class="fas fa-user-plus"></i>
                    </div>
                    <div class="stat-value">
                        <%= (typeof users !== 'undefined') ? users.filter(u => {
                            const oneWeekAgo = new Date();
                            oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
                            return new Date(u.createdAt) > oneWeekAgo;
                        }).length : 0 %>
                    </div>
                    <div class="stat-label">Mới (7 ngày)</div>
                </div>
                <div class="stat-card admin">
                    <div class="stat-icon">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <div class="stat-value">
                        <%= (typeof users !== 'undefined') ? users.filter(u => u.role === 'admin').length : 0 %>
                    </div>
                    <div class="stat-label">Quản trị viên</div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="openAddUserModal()">
                    <i class="fas fa-plus"></i>
                    Thêm người dùng
                </button>
                <button class="btn btn-secondary" onclick="exportUsers()">
                    <i class="fas fa-download"></i>
                    Xuất Excel
                </button>
                <button class="btn btn-warning" onclick="bulkAction()">
                    <i class="fas fa-edit"></i>
                    Thao tác hàng loạt
                </button>
                <button class="btn btn-success" onclick="refreshUsers()">
                    <i class="fas fa-sync"></i>
                    Làm mới
                </button>
            </div>

            <!-- Filters -->
            <div class="filters">
                <div class="filter-group">
                    <label>Vai trò:</label>
                    <select id="roleFilter" onchange="filterUsers()">
                        <option value="">Tất cả</option>
                        <option value="user">Người dùng</option>
                        <option value="admin">Quản trị viên</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Trạng thái:</label>
                    <select id="statusFilter" onchange="filterUsers()">
                        <option value="">Tất cả</option>
                        <option value="active">Hoạt động</option>
                        <option value="inactive">Tạm dừng</option>
                        <option value="verified">Đã xác thực</option>
                        <option value="unverified">Chưa xác thực</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Từ ngày:</label>
                    <input type="date" id="fromDate" onchange="filterUsers()">
                </div>
                <div class="filter-group">
                    <label>Đến ngày:</label>
                    <input type="date" id="toDate" onchange="filterUsers()">
                </div>
                <button class="btn btn-secondary btn-sm" onclick="clearFilters()">
                    <i class="fas fa-times"></i>
                    Xóa bộ lọc
                </button>
            </div>

            <!-- Users Table -->
            <div class="users-table">
                <div class="table-header">
                    <h3>
                        Danh sách người dùng
                        <% if (typeof pagination !== 'undefined' && pagination.total) { %>
                            (<%= pagination.total %> người dùng)
                        <% } %>
                    </h3>
                    <div class="table-controls">
                        <div class="search-box">
                            <input type="text" id="searchInput" placeholder="Tìm kiếm người dùng..." onkeyup="searchUsers()">
                            <i class="fas fa-search"></i>
                        </div>
                        <select id="itemsPerPage" onchange="changeItemsPerPage()">
                            <option value="10">10 / trang</option>
                            <option value="25" selected>25 / trang</option>
                            <option value="50">50 / trang</option>
                            <option value="100">100 / trang</option>
                        </select>
                    </div>
                </div>

                <div class="table-container">
                    <% if (typeof users !== 'undefined' && users.length > 0) { %>
                        <table id="usersTable">
                            <thead>
                                <tr>
                                <tr>
                                    <th>
                                        <input type="checkbox" id="selectAll" onchange="toggleSelectAll()">
                                    </th>
                                    <th>Người dùng</th>
                                    <th>Email</th>
                                    <th>Số điện thoại</th>
                                    <th>Vai trò</th>
                                    <th>Trạng thái</th>
                                    <th>Ngày đăng ký</th>
                                    <th>Thao tác</th>
                                </tr>
                            </thead>
                            <tbody id="usersTableBody">
                                <% users.forEach(function(user) { %>
                                    <tr>
                                        <td>
                                            <input type="checkbox" class="user-checkbox" value="<%= user._id %>">
                                        </td>
                                        <td>
                                            <div class="user-info-cell">
                                                <div class="user-avatar-cell">
                                                    <%= user.firstName ? user.firstName.charAt(0).toUpperCase() : 'U' %><%= user.lastName ? user.lastName.charAt(0).toUpperCase() : 'U' %>
                                                </div>
                                                <div class="user-details">
                                                    <h4><%= user.firstName || 'N/A' %> <%= user.lastName || '' %></h4>
                                                    <p>ID: #<%= user._id.toString().slice(-6) %></p>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <%= user.email %>
                                            <% if (user.isVerified) { %>
                                                <i class="fas fa-check-circle" style="color: #28a745; margin-left: 5px;" title="Email đã xác thực"></i>
                                            <% } %>
                                        </td>
                                        <td>
                                            <%= user.phone || 'Chưa cập nhật' %>
                                        </td>
                                        <td>
                                            <% if (user.role === 'admin') { %>
                                                <span class="role-badge role-admin">Quản trị viên</span>
                                            <% } else { %>
                                                <span class="role-badge role-user">Người dùng</span>
                                            <% } %>
                                        </td>
                                        <td>
                                            <% if (user.isActive) { %>
                                                <span class="status-badge status-active">Hoạt động</span>
                                            <% } else { %>
                                                <span class="status-badge status-inactive">Tạm dừng</span>
                                            <% } %>
                                            <% if (user.isVerified) { %>
                                                <span class="status-badge status-verified">Đã xác thực</span>
                                            <% } else { %>
                                                <span class="status-badge status-unverified">Chưa xác thực</span>
                                            <% } %>
                                        </td>
                                        <td>
                                            <%= new Date(user.createdAt).toLocaleDateString('vi-VN') %>
                                        </td>
                                        <td>
                                            <div class="action-buttons-cell">
                                                <button class="btn btn-sm btn-primary" onclick="viewUser('<%= user._id %>')" title="Xem chi tiết">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button class="btn btn-sm btn-success" onclick="editUser('<%= user._id %>')" title="Chỉnh sửa">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <% if (user.role !== 'admin' || user._id.toString() !== (user && user._id ? user._id.toString() : '')) { %>
                                                    <button class="btn btn-sm btn-warning" onclick="toggleUserStatus('<%= user._id %>', <%= user.isActive %>)" title="<%= user.isActive ? 'Tạm dừng' : 'Kích hoạt' %>">
                                                        <i class="fas fa-toggle-<%= user.isActive ? 'on' : 'off' %>"></i>
                                                    </button>
                                                    <button class="btn btn-sm btn-danger" onclick="deleteUser('<%= user._id %>')" title="Xóa">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                <% } else { %>
                                                    <button class="btn btn-sm btn-secondary" disabled title="Không thể thay đổi admin">
                                                        <i class="fas fa-lock"></i>
                                                    </button>
                                                <% } %>
                                            </div>
                                        </td>
                                    </tr>
                                <% }) %>
                            </tbody>
                        </table>
                    <% } else { %>
                        <div class="empty-state">
                            <i class="fas fa-users"></i>
                            <h3>Không có người dùng nào</h3>
                            <p>Hiện tại chưa có người dùng nào trong hệ thống.</p>
                        </div>
                    <% } %>
                </div>

                <!-- Pagination -->
                <% if (typeof pagination !== 'undefined' && pagination.totalPages > 1) { %>
                    <div class="pagination">
                        <% if (pagination.hasPrev) { %>
                            <a href="?page=<%= pagination.currentPage - 1 %>" class="pagination-btn">
                                <i class="fas fa-chevron-left"></i>
                            </a>
                        <% } else { %>
                            <button class="pagination-btn" disabled>
                                <i class="fas fa-chevron-left"></i>
                            </button>
                        <% } %>

                        <% for (let i = Math.max(1, pagination.currentPage - 2); i <= Math.min(pagination.totalPages, pagination.currentPage + 2); i++) { %>
                            <% if (i === pagination.currentPage) { %>
                                <button class="pagination-btn active"><%= i %></button>
                            <% } else { %>
                                <a href="?page=<%= i %>" class="pagination-btn"><%= i %></a>
                            <% } %>
                        <% } %>

                        <% if (pagination.hasNext) { %>
                            <a href="?page=<%= pagination.currentPage + 1 %>" class="pagination-btn">
                                <i class="fas fa-chevron-right"></i>
                            </a>
                        <% } else { %>
                            <button class="pagination-btn" disabled>
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        <% } %>

                        <div class="pagination-info">
                            Hiển thị <%= (pagination.currentPage - 1) * 20 + 1 %>-<%= Math.min(pagination.currentPage * 20, pagination.total) %> trong <%= pagination.total %> người dùng
                        </div>
                    </div>
                <% } %>
            </div>
        </div>
    </div>

    <!-- Add/Edit User Modal -->
    <div class="modal" id="userModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Thêm người dùng mới</h3>
                <button class="close-btn" onclick="closeUserModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <form id="userForm" onsubmit="saveUser(event)">
                <input type="hidden" id="userId">
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="firstName">Họ <span style="color: red;">*</span></label>
                        <input type="text" id="firstName" name="firstName" required>
                    </div>
                    <div class="form-group">
                        <label for="lastName">Tên <span style="color: red;">*</span></label>
                        <input type="text" id="lastName" name="lastName" required>
                    </div>
                </div>

                <div class="form-group">
                    <label for="email">Email <span style="color: red;">*</span></label>
                    <input type="email" id="email" name="email" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="phone">Số điện thoại</label>
                        <input type="tel" id="phone" name="phone">
                    </div>
                    <div class="form-group">
                        <label for="birthDate">Ngày sinh</label>
                        <input type="date" id="birthDate" name="birthDate">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="gender">Giới tính</label>
                        <select id="gender" name="gender">
                            <option value="">Chọn giới tính</option>
                            <option value="male">Nam</option>
                            <option value="female">Nữ</option>
                            <option value="other">Khác</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="role">Vai trò <span style="color: red;">*</span></label>
                        <select id="role" name="role" required>
                            <option value="user">Người dùng</option>
                            <option value="admin">Quản trị viên</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="password">Mật khẩu <span style="color: red;">*</span></label>
                    <input type="password" id="password" name="password" required>
                    <small style="color: #666; font-size: 0.85rem;">Tối thiểu 6 ký tự</small>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="isActive" name="isActive" checked>
                    <label for="isActive">Kích hoạt tài khoản</label>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="isVerified" name="isVerified">
                    <label for="isVerified">Xác thực email</label>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        Lưu người dùng
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeUserModal()">
                        <i class="fas fa-times"></i>
                        Hủy bỏ
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Auto-hide flash messages
        document.addEventListener('DOMContentLoaded', function() {
            const flashMessages = document.querySelectorAll('.flash-message');
            flashMessages.forEach(message => {
                setTimeout(() => {
                    message.style.animation = 'slideOut 0.3s ease-out forwards';
                    setTimeout(() => {
                        if (message.parentNode) {
                            message.parentNode.removeChild(message);
                        }
                    }, 300);
                }, 5000);
            });
        });

        // Add slideOut animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);

        // Filter users
        function filterUsers() {
            const role = document.getElementById('roleFilter').value;
            const status = document.getElementById('statusFilter').value;
            const fromDate = document.getElementById('fromDate').value;
            const toDate = document.getElementById('toDate').value;

            const params = new URLSearchParams(window.location.search);
            if (role) params.set('role', role);
            else params.delete('role');
            if (status) params.set('status', status);
            else params.delete('status');
            if (fromDate) params.set('fromDate', fromDate);
            else params.delete('fromDate');
            if (toDate) params.set('toDate', toDate);
            else params.delete('toDate');

            window.location.search = params.toString();
        }

        // Search users
        function searchUsers() {
            const searchTerm = document.getElementById('searchInput').value;
            const params = new URLSearchParams(window.location.search);
            if (searchTerm) params.set('search', searchTerm);
            else params.delete('search');
            window.location.search = params.toString();
        }

        // Clear filters
        function clearFilters() {
            document.getElementById('roleFilter').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('fromDate').value = '';
            document.getElementById('toDate').value = '';
            document.getElementById('searchInput').value = '';
            window.location.search = '';
        }

        // Toggle select all
        function toggleSelectAll() {
            const selectAll = document.getElementById('selectAll');
            const checkboxes = document.querySelectorAll('.user-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
            });
        }

        // Get selected users
        function getSelectedUsers() {
            const checkboxes = document.querySelectorAll('.user-checkbox:checked');
            return Array.from(checkboxes).map(cb => cb.value);
        }

        // Modal functions
        function openAddUserModal() {
            document.getElementById('modalTitle').textContent = 'Thêm người dùng mới';
            document.getElementById('userForm').reset();
            document.getElementById('userId').value = '';
            document.getElementById('isActive').checked = true;
            document.getElementById('userModal').classList.add('show');
        }

        function closeUserModal() {
            document.getElementById('userModal').classList.remove('show');
        }

        // User CRUD operations
        function viewUser(id) {
            window.location.href = `/admin/users/${id}`;
        }

        function editUser(id) {
            // Fetch user data and populate form
            fetch(`/admin/users/${id}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const user = data.user;
                        document.getElementById('modalTitle').textContent = 'Chỉnh sửa người dùng';
                        document.getElementById('userId').value = user._id;
                        document.getElementById('firstName').value = user.firstName || '';
                        document.getElementById('lastName').value = user.lastName || '';
                        document.getElementById('email').value = user.email || '';
                        document.getElementById('phone').value = user.phone || '';
                        document.getElementById('birthDate').value = user.birthDate ? user.birthDate.split('T')[0] : '';
                        document.getElementById('gender').value = user.gender || '';
                        document.getElementById('role').value = user.role || 'user';
                        document.getElementById('password').removeAttribute('required');
                        document.getElementById('isActive').checked = user.isActive;
                        document.getElementById('isVerified').checked = user.isVerified;
                        document.getElementById('userModal').classList.add('show');
                    }
                })
                .catch(error => {
                    showNotification('Không thể tải thông tin người dùng', 'error');
                });
        }

        function saveUser(event) {
            event.preventDefault();
            const form = document.getElementById('userForm');
            const formData = new FormData(form);
            const userId = document.getElementById('userId').value;
            
            const url = userId ? `/admin/users/${userId}/edit` : '/admin/users/add';
            const method = 'POST';

            fetch(url, {
                method: method,
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification(data.message, 'success');
                    closeUserModal();
                    setTimeout(() => {
                        window.location.reload();
                    }, 1500);
                } else {
                    showNotification(data.message, 'error');
                }
            })
            .catch(error => {
                showNotification('Có lỗi xảy ra khi lưu người dùng', 'error');
            });
        }

        function toggleUserStatus(id, currentStatus) {
            const newStatus = !currentStatus;
            const action = newStatus ? 'kích hoạt' : 'tạm dừng';
            
            if (confirm(`Bạn có chắc chắn muốn ${action} người dùng này?`)) {
                fetch(`/admin/users/${id}/status`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ isActive: newStatus })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showNotification(data.message, 'success');
                        setTimeout(() => {
                            window.location.reload();
                        }, 1500);
                    } else {
                        showNotification(data.message, 'error');
                    }
                })
                .catch(error => {
                    showNotification('Có lỗi xảy ra!', 'error');
                });
            }
        }

        function deleteUser(id) {
            if (confirm('Bạn có chắc chắn muốn xóa người dùng này? Hành động này không thể hoàn tác!')) {
                fetch(`/admin/users/${id}`, {
                    method: 'DELETE',
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showNotification(data.message, 'success');
                        setTimeout(() => {
                            window.location.reload();
                        }, 1500);
                    } else {
                        showNotification(data.message, 'error');
                    }
                })
                .catch(error => {
                    showNotification('Có lỗi xảy ra!', 'error');
                });
            }
        }

        // Bulk operations
        function bulkAction() {
            const selectedUsers = getSelectedUsers();
            if (selectedUsers.length === 0) {
                showNotification('Vui lòng chọn ít nhất một người dùng!', 'warning');
                return;
            }

            const action = prompt('Chọn thao tác:\n1. Kích hoạt\n2. Tạm dừng\n3. Xóa\n4. Cấp quyền admin\n5. Thu hồi quyền admin\n\nNhập số (1-5):');
            
            const actions = {
                '1': { action: 'activate', message: 'kích hoạt' },
                '2': { action: 'deactivate', message: 'tạm dừng' },
                '3': { action: 'delete', message: 'xóa' },
                '4': { action: 'promote', message: 'cấp quyền admin' },
                '5': { action: 'demote', message: 'thu hồi quyền admin' }
            };

            if (actions[action]) {
                const selectedAction = actions[action];
                if (action === '3' && !confirm(`Bạn có chắc chắn muốn ${selectedAction.message} ${selectedUsers.length} người dùng? Hành động này không thể hoàn tác!`)) {
                    return;
                }

                fetch('/admin/users/bulk', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        userIds: selectedUsers,
                        action: selectedAction.action
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showNotification(`Đã ${selectedAction.message} ${selectedUsers.length} người dùng!`, 'success');
                        setTimeout(() => {
                            window.location.reload();
                        }, 1500);
                    } else {
                        showNotification(data.message, 'error');
                    }
                })
                .catch(error => {
                    showNotification('Có lỗi xảy ra!', 'error');
                });
            }
        }

        // Export users
        function exportUsers() {
            const selectedUsers = getSelectedUsers();
            const exportType = selectedUsers.length > 0 ? 'selected' : 'all';
            
            showNotification('Đang xuất dữ liệu...', 'info');
            
            const params = new URLSearchParams();
            if (exportType === 'selected') {
                params.set('userIds', selectedUsers.join(','));
            }
            
            window.location.href = `/admin/users/export?${params.toString()}`;
        }

        // Refresh users
        function refreshUsers() {
            window.location.reload();
        }

        // Change items per page
        function changeItemsPerPage() {
            const limit = document.getElementById('itemsPerPage').value;
            const params = new URLSearchParams(window.location.search);
            params.set('limit', limit);
            params.delete('page');
            window.location.search = params.toString();
        }

        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `flash-message flash-${type}`;
            
            const icon = {
                'success': 'fas fa-check-circle',
                'error': 'fas fa-exclamation-circle',
                'warning': 'fas fa-exclamation-triangle',
                'info': 'fas fa-info-circle'
            };
            
            notification.innerHTML = `<i class="${icon[type]}"></i> ${message}`;
            
            const flashContainer = document.querySelector('.flash-messages') || document.body;
            flashContainer.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-out forwards';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Close modal on outside click
        document.getElementById('userModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeUserModal();
            }
        });

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Users management page initialized');
            
            // Load URL parameters into filters
            const params = new URLSearchParams(window.location.search);
            if (params.get('role')) document.getElementById('roleFilter').value = params.get('role');
            if (params.get('status')) document.getElementById('statusFilter').value = params.get('status');
            if (params.get('fromDate')) document.getElementById('fromDate').value = params.get('fromDate');
            if (params.get('toDate')) document.getElementById('toDate').value = params.get('toDate');
            if (params.get('search')) document.getElementById('searchInput').value = params.get('search');
        });
    </script>
</body>
</html><!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý người dùng - SportShop Admin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8fafc;
            color: #333;
            line-height: 1.6;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 260px;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            overflow-y: auto;
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .sidebar-header h2 {
            font-size: 1.4rem;
            font-weight: 600;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-item {
            margin-bottom: 5px;
        }

        .menu-item a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: all 0.3s ease;
            position: relative;
        }

        .menu-item a:hover {
            background: rgba(255,255,255,0.1);
            color: white;
            transform: translateX(5px);
        }

        .menu-item a.active {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .menu-item a.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: white;
        }

        .menu-item i {
            width: 20px;
            margin-right: 15px;
            text-align: center;
            font-size: 1.1rem;
        }

        /* Main Content */
        .main-content {
            margin-left: 260px;
            min-height: 100vh;
        }

        /* Header */
        .header {
            background: white;
            padding: 15px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-left h1 {
            font-size: 1.8rem;
            color: #333;
            font-weight: 600;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        /* Content */
        .content {
            padding: 30px;
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-sm {
            padding: 8px 15px;
            font-size: 0.9rem;
        }

        /* Filters */
        .filters {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            margin-bottom: 25px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-group label {
            font-weight: 500;
            color: #333;
        }

        .filter-group select,
        .filter-group input {
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            transition: border-color 0.3s ease;
        }

        .filter-group select:focus,
        .filter-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        /* Users Table */
        .users-table {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
            overflow: hidden;
        }

        .table-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .table-header h3 {
            font-size: 1.3rem;
            font-weight: 600;
        }

        .table-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .search-box {
            position: relative;
        }

        .search-box input {
            padding: 8px 35px 8px 12px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            width: 250px;
        }

        .search-box input::placeholder {
            color: rgba(255,255,255,0.7);
        }

        .search-box i {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255,255,255,0.7);
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #f1f5f9;
        }

        th {
            background: #f8fafc;
            font-weight: 600;
            color: #333;
        }

        .user-info-cell {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-avatar-cell {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .user-details h4 {
            font-weight: 600;
            color: #333;
            margin-bottom: 3px;
        }

        .user-details p {
            color: #666;
            font-size: 0.9rem;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .status-verified {
            background: #d1ecf1;
            color: #0c5460;
        }

        .role-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .role-admin {
            background: #fff3cd;
            color: #856404;
        }

        .role-user {
            background: #e2e3e5;
            color: #383d41;
        }

        .action-buttons-cell {
            display: flex;
            gap: 8px;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 25px;
        }

        .pagination-btn {
            padding: 8px 15px;
            border: 2px solid #e0e0e0;
            background: white;
            color: #666;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pagination-btn:hover {
            border-color: #667eea;
            color: #667eea;
        }

        .pagination-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .main-content {
                margin-left: 0;
            }

            .header {
                padding: 15px 20px;
            }

            .content {
                padding: 20px;
            }

            .filters {
                flex-direction: column;
                align-items: stretch;
            }

            .action-buttons {
                flex-direction: column;
            }

            .table-container {
                font-size: 0.9rem;
            }

            .search-box input {
                width: 200px;
            }
        }

        /* Notification */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            font-weight: 500;
            z-index: 3000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: #28a745;
        }

        .notification.error {
            background: #dc3545;
        }

        .notification.warning {
            background: #ffc107;
            color: #212529;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>SportShop Admin</h2>
        </div>
        
        <nav class="sidebar-menu">
            <div class="menu-item">
                <a href="/admin/">
                    <i class="fas fa-chart-pie"></i>
                    <span>Dashboard</span>
                </a>
            </div>
            <div class="menu-item">
                <a href="/admin/products">
                    <i class="fas fa-box"></i>
                    <span>Quản lý sản phẩm</span>
                </a>
            </div>
            <div class="menu-item">
                <a href="/admin/orders">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Quản lý đơn hàng</span>
                </a>
            </div>
            <div class="menu-item">
                <a href="/admin/users" class="active">
                    <i class="fas fa-users"></i>
                    <span>Quản lý người dùng</span>
                </a>
            </div>
            <div class="menu-item">
                <a href="/admin/statistics">
                    <i class="fas fa-chart-bar"></i>
                    <span>Thống kê</span>
                </a>
            </div>
            <div class="menu-item">
                <a href="#" onclick="showSection('settings')">
                    <i class="fas fa-cog"></i>
                    <span>Cài đặt</span>
                </a>
            </div>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1>Quản lý người dùng</h1>
            </div>
            <div class="header-right">
                <div class="user-info">
                    <div class="user-avatar">AS</div>
                    <div>
                        <div style="font-weight: 500;">Admin SportShop</div>
                        <div style="font-size: 0.8rem; color: #666;">admin@sportshop.com</div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Content -->
        <div class="content">
            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="addUser()">
                    <i class="fas fa-plus"></i>
                    Thêm người dùng
                </button>
                <button class="btn btn-secondary" onclick="exportUsers()">
                    <i class="fas fa-download"></i>
                    Xuất Excel
                </button>
                <button class="btn btn-warning" onclick="bulkAction()">
                    <i class="fas fa-edit"></i>
                    Thao tác hàng loạt
                </button>
            </div>

            <!-- Filters -->
            <div class="filters">
                <div class="filter-group">
                    <label>Vai trò:</label>
                    <select id="roleFilter" onchange="filterUsers()">
                        <option value="">Tất cả</option>
                        <option value="user">Người dùng</option>
                        <option value="admin">Quản trị viên</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Trạng thái:</label>
                    <select id="statusFilter" onchange="filterUsers()">
                        <option value="">Tất cả</option>
                        <option value="active">Hoạt động</option>
                        <option value="inactive">Tạm dừng</option>
                        <option value="verified">Đã xác thực</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Từ ngày:</label>
                    <input type="date" id="fromDate" onchange="filterUsers()">
                </div>
                <div class="filter-group">
                    <label>Đến ngày:</label>
                    <input type="date" id="toDate" onchange="filterUsers()">
                </div>
                <button class="btn btn-secondary btn-sm" onclick="clearFilters()">
                    <i class="fas fa-times"></i>
                    Xóa bộ lọc
                </button>
            </div>

            <!-- Users Table -->
            <div class="users-table">
                <div class="table-header">
                    <h3>Danh sách người dùng</h3>
                    <div class="table-controls">
                        <div class="search-box">
                            <input type="text" id="searchInput" placeholder="Tìm kiếm người dùng..." onkeyup="searchUsers()">
                            <i class="fas fa-search"></i>
                        </div>
                        <select id="itemsPerPage" onchange="changeItemsPerPage()">
                            <option value="10">10 / trang</option>
                            <option value="25" selected>25 / trang</option>
                            <option value="50">50 / trang</option>
                            <option value="100">100 / trang</option>
                        </select>
                    </div>
                </div>

                <div class="table-container">
                    <table id="usersTable">
                        <thead>
                            <tr>
                                <th>
                                    <input type="checkbox" id="selectAll" onchange="toggleSelectAll()">
                                </th>
                                <th>Người dùng</th>
                                <th>Email</th>
                                <th>Số điện thoại</th>
                                <th>Vai trò</th>
                                <th>Trạng thái</th>
                                <th>Ngày đăng ký</th>
                                <th>Thao tác</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- Sample data -->
                            <tr>
                                <td><input type="checkbox" class="user-checkbox" value="1"></td>
                                <td>
                                    <div class="user-info-cell">
                                        <div class="user-avatar-cell">NA</div>
                                        <div class="user-details">
                                            <h4>Nguyễn Văn A</h4>
                                            <p>ID: #USER001</p>
                                        </div>
                                    </div>
                                </td>
                                <td>nguyenvana@email.com</td>
                                <td>0987654321</td>
                                <td>
                                    <span class="role-badge role-user">Người dùng</span>
                                </td>
                                <td>
                                    <span class="status-badge status-active">Hoạt động</span>
                                    <span class="status-badge status-verified">Đã xác thực</span>
                                </td>
                                <td>15/01/2024</td>
                                <td>
                                    <div class="action-buttons-cell">
                                        <button class="btn btn-sm btn-primary" onclick="viewUser(1)" title="Xem chi tiết">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-success" onclick="editUser(1)" title="Chỉnh sửa">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-warning" onclick="toggleUserStatus(1)" title="Thay đổi trạng thái">
                                            <i class="fas fa-toggle-on"></i>
                                        </button>
                                        <button class="btn btn-sm btn-danger" onclick="deleteUser(1)" title="Xóa">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td><input type="checkbox" class="user-checkbox" value="2"></td>
                                <td>
                                    <div class="user-info-cell">
                                        <div class="user-avatar-cell">TB</div>
                                        <div class="user-details">
                                            <h4>Trần Thị B</h4>
                                            <p>ID: #USER002</p>
                                        </div>
                                    </div>
                                </td>
                                <td>tranthib@email.com</td>
                                <td>0987654322</td>
                                <td>
                                    <span class="role-badge role-user">Người dùng</span>
                                </td>
                                <td>
                                    <span class="status-badge status-active">Hoạt động</span>
                                </td>
                                <td>14/01/2024</td>
                                <td>
                                    <div class="action-buttons-cell">
                                        <button class="btn btn-sm btn-primary" onclick="viewUser(2)" title="Xem chi tiết">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-success" onclick="editUser(2)" title="Chỉnh sửa">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-warning" onclick="toggleUserStatus(2)" title="Thay đổi trạng thái">
                                            <i class="fas fa-toggle-on"></i>
                                        </button>
                                        <button class="btn btn-sm btn-danger" onclick="deleteUser(2)" title="Xóa">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td><input type="checkbox" class="user-checkbox" value="3"></td>
                                <td>
                                    <div class="user-info-cell">
                                        <div class="user-avatar-cell">AS</div>
                                        <div class="user-details">
                                            <h4>Admin SportShop</h4>
                                            <p>ID: #ADMIN001</p>
                                        </div>
                                    </div>
                                </td>
                                <td>admin@sportshop.com</td>
                                <td>0866387718</td>
                                <td>
                                    <span class="role-badge role-admin">Quản trị viên</span>
                                </td>
                                <td>
                                    <span class="status-badge status-active">Hoạt động</span>
                                    <span class="status-badge status-verified">Đã xác thực</span>
                                </td>
                                <td>01/01/2024</td>
                                <td>
                                    <div class="action-buttons-cell">
                                        <button class="btn btn-sm btn-primary" onclick="viewUser(3)" title="Xem chi tiết">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-success" onclick="editUser(3)" title="Chỉnh sửa">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-secondary" disabled title="Không thể thay đổi admin">
                                            <i class="fas fa-lock"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div class="pagination">
                    <button class="pagination-btn" disabled>
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <button class="pagination-btn active">1</button>
                    <button class="pagination-btn">2</button>
                    <button class="pagination-btn">3</button>
                    <button class="pagination-btn">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                    <div style="margin-left