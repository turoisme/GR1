<!-- views/admin/dashboard.ejs -->
<!-- Stats Grid -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-header">
            <div class="stat-title">Tổng sản phẩm</div>
            <div class="stat-icon products">
                <i class="fas fa-box"></i>
            </div>
        </div>
        <div class="stat-number"><%= stats.totalProducts %></div>
        <div class="stat-change positive">
            <i class="fas fa-arrow-up"></i>
            <span>+12% so với tháng trước</span>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-header">
            <div class="stat-title">Người dùng</div>
            <div class="stat-icon users">
                <i class="fas fa-users"></i>
            </div>
        </div>
        <div class="stat-number"><%= stats.totalUsers %></div>
        <div class="stat-change positive">
            <i class="fas fa-arrow-up"></i>
            <span>+8% so với tháng trước</span>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-header">
            <div class="stat-title">Đơn hàng</div>
            <div class="stat-icon orders">
                <i class="fas fa-shopping-cart"></i>
            </div>
        </div>
        <div class="stat-number"><%= stats.totalOrders %></div>
        <div class="stat-change positive">
            <i class="fas fa-arrow-up"></i>
            <span>+25% so với tháng trước</span>
        </div>
    </div>
    
    <div class="stat-card">
        <div class="stat-header">
            <div class="stat-title">Doanh thu tháng</div>
            <div class="stat-icon revenue">
                <i class="fas fa-dollar-sign"></i>
            </div>
        </div>
        <div class="stat-number">₫2.5M</div>
        <div class="stat-change positive">
            <i class="fas fa-arrow-up"></i>
            <span>+18% so với tháng trước</span>
        </div>
    </div>
</div>

<!-- Quick Actions -->
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-bottom: 32px;">
    <div class="admin-card">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-bolt icon"></i>
                Hành động nhanh
            </h3>
        </div>
        <div class="card-body">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                <a href="/admin/products/add" class="btn btn-primary btn-lg">
                    <i class="fas fa-plus"></i>
                    Thêm sản phẩm
                </a>
                <a href="/admin/orders" class="btn btn-info btn-lg">
                    <i class="fas fa-eye"></i>
                    Xem đơn hàng
                </a>
                <a href="/admin/users" class="btn btn-success btn-lg">
                    <i class="fas fa-user-plus"></i>
                    Quản lý user
                </a>
                <a href="/admin/statistics" class="btn btn-warning btn-lg">
                    <i class="fas fa-chart-bar"></i>
                    Thống kê
                </a>
            </div>
        </div>
    </div>
    
    <div class="admin-card">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-clock icon"></i>
                Hoạt động hôm nay
            </h3>
        </div>
        <div class="card-body">
            <div style="space-y: 16px;">
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border);">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div>
                            <div style="font-weight: 600; color: var(--dark);">Đơn hàng mới</div>
                            <div style="font-size: 12px; color: var(--secondary);">5 phút trước</div>
                        </div>
                    </div>
                    <span style="background: #d1fae5; color: #065f46; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">+5</span>
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border);">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <div>
                            <div style="font-weight: 600; color: var(--dark);">Người dùng mới</div>
                            <div style="font-size: 12px; color: var(--secondary);">15 phút trước</div>
                        </div>
                    </div>
                    <span style="background: #dbeafe; color: #1e40af; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">+2</span>
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white;">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div>
                            <div style="font-weight: 600; color: var(--dark);">Doanh thu</div>
                            <div style="font-size: 12px; color: var(--secondary);">Cập nhật liên tục</div>
                        </div>
                    </div>
                    <span style="background: #d1fae5; color: #065f46; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600;">₫850K</span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Recent Orders -->
<div class="admin-card">
    <div class="card-header">
        <h2 class="card-title">
            <i class="fas fa-shopping-cart icon"></i>
            Đơn hàng gần đây
        </h2>
        <div style="display: flex; gap: 12px;">
            <a href="/admin/orders" class="btn btn-outline">
                <i class="fas fa-eye"></i>
                Xem tất cả
            </a>
            <button class="btn btn-primary" onclick="location.reload()">
                <i class="fas fa-sync-alt"></i>
                Làm mới
            </button>
        </div>
    </div>
    
    <% if (recentOrders && recentOrders.length > 0) { %>
        <div style="overflow-x: auto;">
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>Mã đơn</th>
                        <th>Khách hàng</th>
                        <th>Ngày đặt</th>
                        <th>Tổng tiền</th>
                        <th>Trạng thái</th>
                        <th>Hành động</th>
                    </tr>
                </thead>
                <tbody>
                    <% recentOrders.forEach(order => { %>
                        <tr>
                            <td>
                                <div style="font-weight: 600; color: var(--primary);">
                                    #<%= order.orderNumber || order._id.toString().slice(-6) %>
                                </div>
                            </td>
                            <td>
                                <div style="display: flex; align-items: center; gap: 12px;">
                                    <div style="width: 32px; height: 32px; background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: 600;">
                                        <% if (order.userId) { %>
                                            <%= order.userId.firstName.charAt(0) %><%= order.userId.lastName.charAt(0) %>
                                        <% } else { %>
                                            <i class="fas fa-user"></i>
                                        <% } %>
                                    </div>
                                    <div>
                                        <div style="font-weight: 600; color: var(--dark);">
                                            <% if (order.userId) { %>
                                                <%= order.userId.firstName %> <%= order.userId.lastName %>
                                            <% } else { %>
                                                Khách vãng lai
                                            <% } %>
                                        </div>
                                        <% if (order.userId) { %>
                                            <div style="font-size: 12px; color: var(--secondary);">
                                                <%= order.userId.email %>
                                            </div>
                                        <% } %>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div style="font-weight: 500;">
                                    <%= new Date(order.createdAt).toLocaleDateString('vi-VN') %>
                                </div>
                                <div style="font-size: 12px; color: var(--secondary);">
                                    <%= new Date(order.createdAt).toLocaleTimeString('vi-VN', { hour: '2-digit', minute: '2-digit' }) %>
                                </div>
                            </td>
                            <td>
                                <div style="font-weight: 700; font-size: 16px; color: var(--dark);">
                                    <%= order.totalAmount ? order.totalAmount.toLocaleString('vi-VN') : '0' %>₫
                                </div>
                            </td>
                            <td>
                                <% 
                                    let statusClass = 'pending';
                                    let statusText = 'Chờ xử lý';
                                    let statusIcon = 'clock';
                                    
                                    switch(order.status) {
                                        case 'pending':
                                            statusClass = 'pending';
                                            statusText = 'Chờ xử lý';
                                            statusIcon = 'clock';
                                            break;
                                        case 'confirmed':
                                            statusClass = 'active';
                                            statusText = 'Đã xác nhận';
                                            statusIcon = 'check';
                                            break;
                                        case 'shipping':
                                            statusClass = 'active';
                                            statusText = 'Đang giao';
                                            statusIcon = 'truck';
                                            break;
                                        case 'completed':
                                            statusClass = 'completed';
                                            statusText = 'Hoàn thành';
                                            statusIcon = 'check-circle';
                                            break;
                                        case 'cancelled':
                                            statusClass = 'inactive';
                                            statusText = 'Đã hủy';
                                            statusIcon = 'times-circle';
                                            break;
                                    }
                                %>
                                <span class="status-badge <%= statusClass %>">
                                    <i class="fas fa-<%= statusIcon %>"></i>
                                    <%= statusText %>
                                </span>
                            </td>
                            <td>
                                <div style="display: flex; gap: 8px;">
                                    <a href="/admin/orders/<%= order._id %>" class="btn btn-primary btn-sm" title="Xem chi tiết">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <% if (order.status === 'pending') { %>
                                        <button onclick="updateStatus('/admin/orders/<%= order._id %>/status', 'confirmed')" 
                                                class="btn btn-success btn-sm" title="Xác nhận">
                                            <i class="fas fa-check"></i>
                                        </button>
                                    <% } %>
                                    <% if (order.status !== 'cancelled' && order.status !== 'completed') { %>
                                        <button onclick="updateStatus('/admin/orders/<%= order._id %>/status', 'cancelled')" 
                                                class="btn btn-danger btn-sm" title="Hủy đơn">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    <% } %>
                                </div>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
    <% } else { %>
        <div class="card-body">
            <div style="text-align: center; padding: 60px 20px; color: var(--secondary);">
                <div style="font-size: 4rem; margin-bottom: 16px; opacity: 0.5;">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <h3 style="color: var(--secondary); margin-bottom: 8px; font-weight: 600;">Chưa có đơn hàng nào</h3>
                <p style="margin-bottom: 24px;">Các đơn hàng mới sẽ xuất hiện ở đây</p>
                <a href="/admin/products" class="btn btn-primary">
                    <i class="fas fa-plus"></i>
                    Thêm sản phẩm để bắt đầu
                </a>
            </div>
        </div>
    <% } %>
</div>

<!-- Additional Dashboard Cards -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 24px; margin-top: 32px;">
    <!-- Top Products -->
    <div class="admin-card">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-fire icon"></i>
                Sản phẩm bán chạy
            </h3>
            <a href="/admin/products" class="btn btn-outline btn-sm">Xem tất cả</a>
        </div>
        <div class="card-body">
            <div style="space-y: 16px;">
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border);">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="width: 48px; height: 48px; background: var(--light); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-running" style="color: var(--primary); font-size: 20px;"></i>
                        </div>
                        <div>
                            <div style="font-weight: 600; color: var(--dark);">Giày Nike Air Max</div>
                            <div style="font-size: 12px; color: var(--secondary);">Giày thể thao</div>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-weight: 700; color: var(--success);">23 đã bán</div>
                        <div style="font-size: 12px; color: var(--secondary);">₫1.2M</div>
                    </div>
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border);">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="width: 48px; height: 48px; background: var(--light); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-tshirt" style="color: var(--info); font-size: 20px;"></i>
                        </div>
                        <div>
                            <div style="font-weight: 600; color: var(--dark);">Áo Adidas Classic</div>
                            <div style="font-size: 12px; color: var(--secondary);">Áo thể thao</div>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-weight: 700; color: var(--success);">18 đã bán</div>
                        <div style="font-size: 12px; color: var(--secondary);">₫450K</div>
                    </div>
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0;">
                    <div style="display: flex; align-items: center; gap: 12px;">
                        <div style="width: 48px; height: 48px; background: var(--light); border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-baseball-ball" style="color: var(--warning); font-size: 20px;"></i>
                        </div>
                        <div>
                            <div style="font-weight: 600; color: var(--dark);">Quần Puma Sport</div>
                            <div style="font-size: 12px; color: var(--secondary);">Quần thể thao</div>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-weight: 700; color: var(--success);">15 đã bán</div>
                        <div style="font-size: 12px; color: var(--secondary);">₫380K</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Recent Activity -->
    <div class="admin-card">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-history icon"></i>
                Hoạt động gần đây
            </h3>
        </div>
        <div class="card-body">
            <div style="space-y: 16px;">
                <div style="display: flex; align-items: start; gap: 12px; padding: 12px 0; border-bottom: 1px solid var(--border);">
                    <div style="width: 8px; height: 8px; background: var(--success); border-radius: 50%; margin-top: 8px;"></div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; color: var(--dark); margin-bottom: 4px;">
                            Đơn hàng #DH001 đã được xác nhận
                        </div>
                        <div style="font-size: 12px; color: var(--secondary);">2 phút trước</div>
                    </div>
                </div>
                
                <div style="display: flex; align-items: start; gap: 12px; padding: 12px 0; border-bottom: 1px solid var(--border);">
                    <div style="width: 8px; height: 8px; background: var(--info); border-radius: 50%; margin-top: 8px;"></div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; color: var(--dark); margin-bottom: 4px;">
                            Người dùng mới đăng ký: nguyenvana@email.com
                        </div>
                        <div style="font-size: 12px; color: var(--secondary);">5 phút trước</div>
                    </div>
                </div>
                
                <div style="display: flex; align-items: start; gap: 12px; padding: 12px 0; border-bottom: 1px solid var(--border);">
                    <div style="width: 8px; height: 8px; background: var(--primary); border-radius: 50%; margin-top: 8px;"></div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; color: var(--dark); margin-bottom: 4px;">
                            Sản phẩm "Giày Nike Air Force" đã được cập nhật
                        </div>
                        <div style="font-size: 12px; color: var(--secondary);">10 phút trước</div>
                    </div>
                </div>
                
                <div style="display: flex; align-items: start; gap: 12px; padding: 12px 0;">
                    <div style="width: 8px; height: 8px; background: var(--warning); border-radius: 50%; margin-top: 8px;"></div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; color: var(--dark); margin-bottom: 4px;">
                            Cảnh báo: Sản phẩm "Áo Adidas" sắp hết hàng
                        </div>
                        <div style="font-size: 12px; color: var(--secondary);">15 phút trước</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>